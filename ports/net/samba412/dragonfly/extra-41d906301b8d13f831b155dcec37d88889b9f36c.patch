From 41d906301b8d13f831b155dcec37d88889b9f36c Mon Sep 17 00:00:00 2001
From: Andreas Schneider <asn@samba.org>
Date: Wed, 14 Jul 2021 12:49:11 +0200
Subject: [PATCH] mit-samba: Define debug class for kdb module

Signed-off-by: Andreas Schneider <asn@samba.org>
Reviewed-by: Andrew Bartlett <abartlet@samba.org>
---
 source4/kdc/mit-kdb/kdb_samba_change_pwd.c | 3 +++
 source4/kdc/mit-kdb/kdb_samba_common.c     | 3 +++
 source4/kdc/mit-kdb/kdb_samba_masterkey.c  | 3 +++
 source4/kdc/mit-kdb/kdb_samba_pac.c        | 3 +++
 source4/kdc/mit-kdb/kdb_samba_policies.c   | 3 +++
 source4/kdc/mit-kdb/kdb_samba_principals.c | 3 +++
 source4/kdc/mit_samba.c                    | 3 +++
 7 files changed, 21 insertions(+)

diff --git a/source4/kdc/mit-kdb/kdb_samba_change_pwd.c b/source4/kdc/mit-kdb/kdb_samba_change_pwd.c
index e0264cb4f095..ad7bb5d54ea9 100644
--- a/source4/kdc/mit-kdb/kdb_samba_change_pwd.c
+++ b/source4/kdc/mit-kdb/kdb_samba_change_pwd.c
@@ -30,6 +30,9 @@
 #include "kdc/mit_samba.h"
 #include "kdb_samba.h"
 
+#undef DBGC_CLASS
+#define DBGC_CLASS DBGC_KERBEROS
+
 krb5_error_code kdb_samba_change_pwd(krb5_context context,
 				     krb5_keyblock *master_key,
 				     krb5_key_salt_tuple *ks_tuple,
diff --git a/source4/kdc/mit-kdb/kdb_samba_common.c b/source4/kdc/mit-kdb/kdb_samba_common.c
index e89aed6aeba7..35cac193a44b 100644
--- a/source4/kdc/mit-kdb/kdb_samba_common.c
+++ b/source4/kdc/mit-kdb/kdb_samba_common.c
@@ -30,6 +30,9 @@
 #include "kdc/mit_samba.h"
 #include "kdb_samba.h"
 
+#undef DBGC_CLASS
+#define DBGC_CLASS DBGC_KERBEROS
+
 struct mit_samba_context *ks_get_context(krb5_context kcontext)
 {
 	void *db_ctx;
diff --git a/source4/kdc/mit-kdb/kdb_samba_masterkey.c b/source4/kdc/mit-kdb/kdb_samba_masterkey.c
index 2c4fe72d8c21..b068d9647354 100644
--- a/source4/kdc/mit-kdb/kdb_samba_masterkey.c
+++ b/source4/kdc/mit-kdb/kdb_samba_masterkey.c
@@ -31,6 +31,9 @@
 #include "kdc/mit_samba.h"
 #include "kdb_samba.h"
 
+#undef DBGC_CLASS
+#define DBGC_CLASS DBGC_KERBEROS
+
 krb5_error_code kdb_samba_fetch_master_key(krb5_context context,
 					   krb5_principal name,
 					   krb5_keyblock *key,
diff --git a/source4/kdc/mit-kdb/kdb_samba_pac.c b/source4/kdc/mit-kdb/kdb_samba_pac.c
index 15497603b108..75b05a62a07f 100644
--- a/source4/kdc/mit-kdb/kdb_samba_pac.c
+++ b/source4/kdc/mit-kdb/kdb_samba_pac.c
@@ -30,6 +30,9 @@
 #include "kdc/mit_samba.h"
 #include "kdb_samba.h"
 
+#undef DBGC_CLASS
+#define DBGC_CLASS DBGC_KERBEROS
+
 krb5_error_code kdb_samba_dbekd_decrypt_key_data(krb5_context context,
 						 const krb5_keyblock *mkey,
 						 const krb5_key_data *key_data,
diff --git a/source4/kdc/mit-kdb/kdb_samba_policies.c b/source4/kdc/mit-kdb/kdb_samba_policies.c
index 9197551ed619..a8cf280bdb38 100644
--- a/source4/kdc/mit-kdb/kdb_samba_policies.c
+++ b/source4/kdc/mit-kdb/kdb_samba_policies.c
@@ -30,6 +30,9 @@
 #include "kdc/mit_samba.h"
 #include "kdb_samba.h"
 
+#undef DBGC_CLASS
+#define DBGC_CLASS DBGC_KERBEROS
+
 /* FIXME: This is a krb5 function which is exported, but in no header */
 extern krb5_error_code decode_krb5_padata_sequence(const krb5_data *output,
 						   krb5_pa_data ***rep);
diff --git a/source4/kdc/mit-kdb/kdb_samba_principals.c b/source4/kdc/mit-kdb/kdb_samba_principals.c
index 8b67436dc472..c17fe8b0a14d 100644
--- a/source4/kdc/mit-kdb/kdb_samba_principals.c
+++ b/source4/kdc/mit-kdb/kdb_samba_principals.c
@@ -30,6 +30,9 @@
 #include "kdc/mit_samba.h"
 #include "kdb_samba.h"
 
+#undef DBGC_CLASS
+#define DBGC_CLASS DBGC_KERBEROS
+
 #define ADMIN_LIFETIME 60*60*3 /* 3 hours */
 #define CHANGEPW_LIFETIME 60*5 /* 5 minutes */
 
diff --git a/source4/kdc/mit_samba.c b/source4/kdc/mit_samba.c
index feacc1b5f191..b3bb6b1b0321 100644
--- a/source4/kdc/mit_samba.c
+++ b/source4/kdc/mit_samba.c
@@ -40,6 +40,9 @@
 
 #include "mit_samba.h"
 
+#undef DBGC_CLASS
+#define DBGC_CLASS DBGC_KERBEROS
+
 void mit_samba_context_free(struct mit_samba_context *ctx)
 {
 	/* free heimdal's krb5_context */
