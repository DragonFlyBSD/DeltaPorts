# DPorts Generator Scripts

Tools for generating DragonFly BSD's DPorts from FreeBSD Ports Collection.

## New: Unified `dports.py` Tool

The `dports.py` script consolidates all generation functionality into a single tool:

```sh
./dports.py --help              # Show all commands
./dports.py merge --help        # Help for specific command
```

### Commands

| Command | Description | Replaces |
|---------|-------------|----------|
| `merge` | Full merge of ports tree | merge.sh |
| `sync` | Sync single port to potential tree | sync1.sh |
| `prune` | Remove obsolete ports | prune.sh |
| `makefiles` | Generate category Makefiles | category-makefiles.sh |
| `bulk-list` | List ports for poudriere bulk | bulk_dports.sh |
| `daemon` | Run background commit daemon | dports-daemon.sh |
| `stinkers` | Find unbuilt ports with most dependents | stinkers.sh |
| `index` | Generate INDEX file | generate_ports_INDEX.sh |
| `updating` | Generate rolling UPDATING (last year) | rollingUPDATING.sh |
| `quicksync` | Sync ports from file | quicksync.sh |
| `identify-nobody` | Find ports easy to upstream | identify-custom-nobody.sh |
| `deps` | List ports depending on a port | ramo_bulk_list.sh |

### Global Options

```
-c, --config PATH    Config file (default: /usr/local/etc/dports.conf)
-v, --verbose        Verbose output with detailed logging
-n, --dry-run        Show what would be done without making changes
-q, --quiet          Minimal output (errors only)
```

### Examples

```sh
# Full merge (all ports)
./dports.py merge

# Merge specific ports only
./dports.py merge editors/vim shells/bash

# Merge without rebuilding Mk/Templates (faster)
./dports.py merge --no-mk

# Dry run to see what would happen
./dports.py -n merge

# Verbose mode with detailed logging
./dports.py -v merge

# Sync single port to potential tree
./dports.py sync editors/vim

# Preview pruning (scan mode)
./dports.py prune

# Actually prune obsolete ports
./dports.py prune --confirm

# Find ports depending on a specific port
./dports.py deps devel/llvm15
```

### Configuration

Config file: `/usr/local/etc/dports.conf`

```sh
# Required
FPORTS=/usr/ports              # FreeBSD ports tree
MERGED=/path/to/merged         # Output directory
DPORTS=/path/to/DPorts         # DPorts git repository  
DELTA=/path/to/DeltaPorts      # DeltaPorts git repository

# Optional
POTENTIAL=/path/to/potential   # Poudriere ports tree
INDEX=/usr/ports/INDEX-3       # INDEX file location
COMQUEUE=/tmp/crondports       # Daemon queue directory
LOG_DIR=~/.dports/logs         # Log directory
```

Environment variables override config file values:
```sh
DPORTS_FPORTS=/custom/ports ./dports.py merge
```

### Logging

Logs are written to `~/.dports/logs/` by default. Each run creates a timestamped log file:
```
~/.dports/logs/merge_20240115_143022.log
```

Use `-q` to disable logging, or set `LOG_DIR` in config to change location.

---

## Legacy Shell Scripts

The original shell scripts are still available for reference but are deprecated:

- `merge.sh` - Original merge script
- `sync1.sh` - Single port sync  
- `prune.sh` - Prune obsolete ports
- `category-makefiles.sh` - Generate Makefiles
- etc.

---

## Setup (unchanged from original)

1. Install poudriere (or poudriere-devel)

2. Create `/usr/local/etc/dports.conf` (see dports-default.conf for example)

3. Clone repositories:
   - DPorts (read-only) at /usr/dports
   - DeltaPorts (ssh key) at /usr/gen-dports/github/DeltaPorts
   - DPorts (ssh key) at /usr/gen-dports/github/DPorts

4. Configure poudriere hooks if using automated builds

5. Fetch FreeBSD Ports Collection:
   ```sh
   portsnap fetch update
   ```

6. Run initial merge:
   ```sh
   ./dports.py merge
   ```

7. For automated builds, configure poudriere and run:
   ```sh
   poudriere bulk -va -j master -p potential
   ```
